<!DOCTYPE html>
<html
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
        xmlns:p="http://primefaces.org/ui"
        xmlns:h="http://xmlns.jcp.org/jsf/html"
>
<ui:composition template="/templates/template.xhtml">
    <ui:define name="title">Nya.GG - Video Upload</ui:define>
    <ui:define name="heading">Video Upload</ui:define>
    <ui:define name="head">
        <h:outputStylesheet name="/assets/css/videoupload.css"/>
    </ui:define>
    <ui:define name="content">
        <div class="my-3">
            <p:linkButton outcome="/home.xhtml"
                          styleClass="ui-button ui-button-secondary no-underline">
                <i class="pi pi-arrow-left"/> Back to Home
            </p:linkButton>
        </div>

        <!-- File input to select local video -->
        <form id="video-upload-form" action="${pageContext.request.contextPath}/v/" method="post" enctype="multipart/form-data">
            <div class="video-drop-zone" onclick="document.getElementById('video-input').click()">
                <i class="pi pi-cloud-upload upload-icon" />
                <div class="upload-text">Drop your video here</div>
                <div class="upload-hint">or click to browse files</div>
                <button type="button" class="browse-button btn">Choose Video</button>
            </div>

            <!-- Hidden form for submitting to the /v/ endpoint -->
            <input type="file" id="video-input" name="videoInput" accept="video/*" hidden="hidden" />
            <input type="hidden" id="start-time-seconds" name="startTimeSeconds" />
            <input type="hidden" id="end-time-seconds" name="endTimeSeconds" />
            <input type="hidden" id="video-title" name="videoTitle" />
            <input type="hidden" name="_csrf" value="${_csrf.token}" />
        </form>

        <div class="trimmer-container">
            <div class="video-player-wrapper">
                <video id="video-player" class="video-player" preload="auto">
                    <source id="video-source" src="" type="" />
                    Your browser does not support the video tag.
                </video>
                <div id="play-pause-overlay" class="play-pause-overlay">
                    <i id="play-pause-icon" class="pi pi-play" />
                </div>
            </div>

            <h2>Video Trimmer</h2>

            <div class="trimmer-bar" id="trimmerBar">
                <div class="timeline">
                    <div class="timeline-markers" id="timelineMarkers"></div>
                </div>
                <div class="progress-bar" id="progressBar"></div>
                <div class="trimmer-handle handle-left" id="leftHandle"></div>
                <div class="trimmer-handle handle-right" id="rightHandle"></div>
                <div class="position-indicator" id="positionIndicator"></div>
            </div>

            <div class="time-display">
                <div>Start: <span id="startTime">0:00</span></div>
                <div><strong>Selected Duration: <span id="selectedDuration">1:00</span></strong></div>
                <div>End: <span id="endTime">1:00</span></div>
            </div>

            <form class="video-form">
                <div class="form-group">
                    <label for="videoTitleInput" class="form-label">Video Title:</label>
                    <input type="text" id="videoTitleInput" name="videoTitleInput" 
                           class="form-input" placeholder="Enter video title" required="required" />
                </div>
                <div class="form-actions">
                    <button id="trimButton" class="btn btn-primary">Trim And Upload</button>
                    <button id="uploadButton" class="btn btn-secondary">Upload Full Video</button>
                </div>
            </form>
        </div>

        <h:outputScript name="/assets/js/fileinput.js"/>
        <h:outputScript name="/assets/js/trimmer.js"/>
    </ui:define>

</ui:composition>
</html>
