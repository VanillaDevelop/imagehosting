<!DOCTYPE html>
<html
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
        xmlns:p="http://primefaces.org/ui"
        xmlns:h="http://xmlns.jcp.org/jsf/html"
        xmlns:f="http://xmlns.jcp.org/jsf/core"
>
<ui:composition template="/templates/template.xhtml">
    <ui:define name="title">Nya.GG - Video Upload</ui:define>
    <ui:define name="heading">Video Upload</ui:define>
    <ui:define name="head">
        <h:outputStylesheet name="/assets/css/videoupload.css"/>
    </ui:define>
    <ui:define name="content">
        <!-- Navigation Buttons -->
        <div class="my-3 flex-row flex-justify-space-between">
            <p:linkButton outcome="/home.xhtml"
                          styleClass="ui-button-secondary">
                <i class="pi pi-arrow-left"/> Back to Home
            </p:linkButton>
            <p:linkButton outcome="/videolibrary.xhtml"
                          styleClass="ui-button-secondary">
                <i class="pi pi-video"/> My Library
            </p:linkButton>
        </div>

        <div id="video-selection">
            <!-- Settings Accordion -->
            <p:accordionPanel activeIndex="null" styleClass="mt-5">
                <p:tab title="Settings">
                    <h:form id="upload-mode-form" styleClass="form-small">
                        <input type="hidden" name="_csrf" value="${_csrf.token}" />
                        <div>
                            <div class="flex-row flex-align-center mb-2">
                                <p:outputLabel for="upload-mode" styleClass="inline-block m-0" value="URL Generator Strategy" />
                                <i class="pi pi-info-circle" title="Determines how video URLs are generated. Timestamps are based on upload time. Random character strings provide shorter, less secure blobs than UUIDs." />
                            </div>
                            <div class="flex-row">
                                <p:selectOneMenu id="upload-mode" value="#{videoUploadBean.videoUploadUser.videoUploadMode}">
                                    <f:selectItems value="#{videoUploadBean.availableUploadModes}" var="mode"
                                                   itemLabel="#{mode.description}"
                                                   itemValue="#{mode}" />
                                </p:selectOneMenu>
                                <p:commandButton value="Update"
                                                 action="#{videoUploadBean.updateUploadType}" update="upload-mode-form" />
                            </div>
                        </div>
                    </h:form>
                </p:tab>
            </p:accordionPanel>

            <!-- File input to select local video -->
            <form id="video-upload-form" action="${pageContext.request.contextPath}/v/" method="post" enctype="multipart/form-data">
                <div class="video-drop-zone text-center my-3">
                    <i class="pi pi-cloud-upload upload-icon mb-2" />
                    <div class="upload-text mb-1"><strong>Drop your video here</strong></div>
                    <div class="upload-hint mb-4"><small>or click to browse files</small></div>
                    <p:commandButton type="button" value="Choose Video" />
                </div>

                <!-- Hidden form for submitting to the /v/ endpoint -->
                <input type="file" id="video-input" name="videoInput" accept="video/*" hidden="hidden" />
                <input type="hidden" id="start-time-seconds" name="startTimeSeconds" />
                <input type="hidden" id="end-time-seconds" name="endTimeSeconds" />
                <input type="hidden" id="video-title" name="videoTitle" />
                <input type="hidden" name="_csrf" value="${_csrf.token}" />
            </form>
        </div>

        <!-- Video Trimmer -->
        <div id="trimmer-container" class="trimmer-container mt-5" style="display: none;">
            <div class="video-player-wrapper">
                <video id="video-player" class="video-player" preload="auto">
                    <source id="video-source" src="" type="" />
                    Your browser does not support the video tag.
                </video>
                <div id="play-pause-overlay" class="play-pause-overlay">
                    <i id="play-pause-icon" class="pi pi-play" />
                </div>
            </div>

            <div class="trimmer-bar my-2" id="trimmer-bar">
                <div class="timeline-markers flex-row flex-justify-space-between">
                    <ui:repeat value="#{[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]}" var="i">
                        <div class="marker"><!-- --></div>
                    </ui:repeat>
                </div>
                <div class="progress-bar" id="progress-bar"><!-- --></div>
                <div class="trimmer-handle handle-left" id="left-handle"><!-- --></div>
                <div class="trimmer-handle handle-right" id="right-handle"><!-- --></div>
                <div class="position-indicator" id="position-indicator"><!-- --></div>
            </div>

            <div class="flex-row flex-justify-space-between text-light">
                <div>Start: <span id="start-time">00:00</span></div>
                <div><strong>Selected Duration: <span id="selected-duration">01:00</span></strong></div>
                <div>End: <span id="end-time">01:00</span></div>
            </div>

            <form class="video-form form-dark">
                <p:outputLabel for="video-title-input" value="Video Title "/>
                <p:inputText id="video-title-input" maxlength="100" placeholder="Enter video title" required="required" />
                <p:commandButton id="trim-button" value="Trim and Upload"/>
            </form>
        </div>

        <h:outputScript name="/assets/js/videofileinput.js"/>
        <h:outputScript name="/assets/js/videotrimmer.js"/>
    </ui:define>

</ui:composition>
</html>
