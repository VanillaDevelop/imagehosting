<!DOCTYPE html>
<html
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
        xmlns:p="http://primefaces.org/ui"
        xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:f="http://java.sun.com/jsf/core"
>
<ui:composition template="/templates/template.xhtml">
    <ui:define name="title">Nya.GG - Video Upload</ui:define>
    <ui:define name="heading">Video Upload</ui:define>
    <ui:define name="head">
        <h:outputStylesheet name="/assets/css/videoupload.css"/>
    </ui:define>
    <ui:define name="content">
        <div class="my-3 flex-header">
            <p:linkButton outcome="/home.xhtml"
                          styleClass="ui-button ui-button-secondary no-underline">
                <i class="pi pi-arrow-left"/> Back to Home
            </p:linkButton>
            <p:linkButton outcome="/videolibrary.xhtml"
                          styleClass="ui-button ui-button-secondary no-underline">
                <i class="pi pi-video"/> My Library
            </p:linkButton>
        </div>

        <!-- File input to select local video -->
        <form id="video-upload-form" action="${pageContext.request.contextPath}/v/" method="post" enctype="multipart/form-data">
            <div class="video-drop-zone" onclick="document.getElementById('video-input').click()">
                <i class="pi pi-cloud-upload upload-icon" />
                <div class="upload-text">Drop your video here</div>
                <div class="upload-hint">or click to browse files</div>
                <button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only ui-button-primary no-underline">
                    <span class="ui-button-text">Choose Video</span>
                </button>
            </div>

            <!-- Hidden form for submitting to the /v/ endpoint -->
            <input type="file" id="video-input" name="videoInput" accept="video/*" hidden="hidden" />
            <input type="hidden" id="start-time-seconds" name="startTimeSeconds" />
            <input type="hidden" id="end-time-seconds" name="endTimeSeconds" />
            <input type="hidden" id="video-title" name="videoTitle" />
            <input type="hidden" name="_csrf" value="${_csrf.token}" />
        </form>

        <div id="trimmer-container" class="trimmer-container" style="display: none">
            <div class="video-player-wrapper">
                <video id="video-player" class="video-player" preload="auto">
                    <source id="video-source" src="" type="" />
                    Your browser does not support the video tag.
                </video>
                <div id="play-pause-overlay" class="play-pause-overlay">
                    <i id="play-pause-icon" class="pi pi-play" />
                </div>
            </div>

            <div class="trimmer-bar" id="trimmer-bar">
                <div class="timeline">
                    <div class="timeline-markers" id="timelineMarkers">
                        <ui:repeat value="#{[0,1,2,3,4,5,6,7,8,9]}" var="i">
                            <div class="marker"><!-- --></div>
                        </ui:repeat>
                    </div>
                </div>
                <div class="progress-bar" id="progress-bar"><!-- --></div>
                <div class="trimmer-handle handle-left" id="left-handle"><!-- --></div>
                <div class="trimmer-handle handle-right" id="right-handle"><!-- --></div>
                <div class="position-indicator" id="position-indicator"><!-- --></div>
            </div>

            <div class="time-display">
                <div>Start: <span id="start-time">0:00</span></div>
                <div><strong>Selected Duration: <span id="selected-duration">1:00</span></strong></div>
                <div>End: <span id="end-time">1:00</span></div>
            </div>

            <form class="video-form">
                <div class="form-group">
                    <label for="video-title-input" class="form-label">Video Title</label>
                    <input type="text" id="video-title-input" name="videoTitleInput"
                           class="form-input" placeholder="Enter video title" required="required" />
                </div>
                <div class="form-actions">
                    <button id="trim-button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only ui-button-primary-form no-underline">
                        <span class="ui-button-text">Trim And Upload</span>
                    </button>
                </div>
            </form>
        </div>

        <h:outputScript name="/assets/js/fileinput.js"/>
        <h:outputScript name="/assets/js/trimmer.js"/>

        <div class="library-container" hidden="hidden">
            <h2>Library</h2>
            <p:selectOneMenu>
                <f:selectItem itemLabel="#{videoUploadBean.currentUploadMode.toString()}" itemValue="#{videoUploadBean.currentUploadMode}" />
            </p:selectOneMenu>
        </div>
    </ui:define>

</ui:composition>
</html>
